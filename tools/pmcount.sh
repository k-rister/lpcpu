#!/bin/bash

#
# LPCPU (Linux Performance Customer Profiler Utility): ./tools/pmcount.sh
#
# (C) Copyright IBM Corp. 2016
#
# This file is subject to the terms and conditions of the Eclipse
# Public License.  See the file LICENSE.TXT in the main directory of the
# distribution for more details.
#

function usage {
	echo "Usage: $0 <duration> [<set> ...]"
	exit 1
}
if [ $# -lt 1 ]; then
	usage
fi

declare -A group
declare -A setname
declare -A setsize
function set_new_set {
	setname[${#setname[*]}]=$1
 	setsize[$1]=0
}
function set_add_group {
 	if [ -z "${setsize[$1]}" ]; then set_new_set $1; fi
 	group[$1${setsize[$1]}]=$2
 	setsize[$1]=$((setsize[$1]+1))
}

set_add_group utilization 'PM_CYC,PM_INST_DISP,PM_INST_CMPL'

set_add_group cpu_util 'PM_RUN_SPURR,PM_CYC,PM_RUN_PURR'

set_add_group iops 'PM_IOPS_CMPL,PM_CYC,PM_IOPS_DISP,PM_INST_CMPL'

set_add_group smt_modes 'PM_RUN_CYC_ST_MODE,PM_RUN_CYC_SMT2_SHRD_MODE,PM_RUN_CYC_SMT2_MODE,PM_RUN_CYC_SMT8_MODE'
set_add_group smt_modes 'PM_RUN_CYC_SMT2_SPLIT_MODE,PM_RUN_CYC_SMT4_MODE,PM_RUN_CYC_SMT2_MODE,PM_RUN_CYC_SMT8_MODE'

set_add_group smt 'PM_THRD_GRP_CMPL_BOTH_CYC,PM_THRD_ALL_RUN_CYC,PM_THRD_CONC_RUN_INST,PM_THRD_PRIO_0_1_CYC'
set_add_group smt 'PM_THRD_PRIO_0_1_CYC,PM_THRD_PRIO_2_3_CYC,PM_THRD_PRIO_4_5_CYC,PM_THRD_PRIO_6_7_CYC'
set_add_group smt 'PM_ANY_THRD_RUN_CYC,PM_THRD_REBAL_CYC,PM_NEST_REF_CLK'

set_add_group branch 'PM_BR_PRED_BR0,PM_BR_PRED_BR1,PM_BR_UNCOND_BR0,PM_BR_UNCOND_BR1'
set_add_group branch 'PM_BR_PRED_CCACHE_BR0,PM_BR_PRED_CCACHE_BR1,PM_BR_PRED_LSTACK_BR0,PM_BR_PRED_LSTACK_BR1'
set_add_group branch 'PM_BR_PRED_CR_BR0,PM_BR_PRED_CR_BR1,PM_BR_PRED_TA_BR0,PM_BR_PRED_TA_BR1'
set_add_group branch 'PM_BRU_FIN,PM_BR_TAKEN_CMPL,PM_BR_PRED_BR_CMPL,PM_BR_CMPL'
set_add_group branch 'PM_BR_BC_8_CONV,PM_BR_BC_8,PM_BR_UNCOND_BR0,PM_BR_2PATH'
set_add_group branch 'PM_BR_MPRED_LSTACK,PM_BR_MPRED_CCACHE,PM_BR_MPRED_CR,PM_BR_MPRED_TA'

set_add_group flush 'PM_FLUSH_DISP_SYNC,PM_FLUSH_BR_MPRED,PM_FLUSH_DISP_SB,PM_FLUSH'
set_add_group flush 'PM_FLUSH_DISP,PM_FLUSH_PARTIAL,PM_FLUSH_COMPLETION,PM_BR_MPRED_CMPL'
set_add_group flush 'PM_FLUSH_DISP_SYNC,PM_FLUSH_DISP_TLBIE,PM_FLUSH_DISP_SB,PM_FLUSH',

set_add_group dtlb_miss 'PM_DTLB_MISS_16G,PM_DTLB_MISS_4K,PM_DTLB_MISS_64K,PM_DTLB_MISS_16M'

set_add_group derat_miss 'PM_DERAT_MISS_4K,PM_DERAT_MISS_64K,PM_DERAT_MISS_16M,PM_DERAT_MISS_16G'

set_add_group fxu 'PM_FXU_IDLE,PM_FXU_BUSY,PM_FXU0_BUSY_FXU1_IDLE,PM_FXU1_BUSY_FXU0_IDLE'
set_add_group fxu 'PM_FXU0_FIN,PM_FXU1_FIN'
set_add_group fxu 'PM_CYC,PM_FXU_BUSY,PM_FXU0_BUSY_FXU1_IDLE,PM_FXU1_BUSY_FXU0_IDLE'
set_add_group fxu 'PM_FXU_IDLE,PM_FXU_BUSY,PM_CYC,PM_INST_CMPL'

set_add_group disp_clb_held 'PM_DISP_CLB_HELD_BAL,PM_DISP_CLB_HELD_RES,PM_DISP_CLB_HELD_TLBIE,PM_DISP_CLB_HELD_SYNC'
set_add_group disp_clb_held 'PM_DISP_CLB_HELD_SB,PM_DISP_HELD_IQ_FULL,PM_DISP_HELD_SRQ_FULL,PM_DISP_HELD_SYNC_HOLD'

set_add_group dispatch 'PM_DISP_HELD_MAP_FULL,PM_INST_DISP,PM_GRP_DISP,PM_1PLUS_PPC_DISP'

set_add_group cpi 'PM_1PLUS_PPC_CMPL,PM_NTCG_ALL_FIN,PM_GRP_CMPL,PM_CYC'
set_add_group cpi 'PM_CMPLU_STALL,PM_CMPLU_STALL_FXU,PM_CMPLU_STALL_FLUSH,PM_SHL_ST_DISABLE'
set_add_group cpi 'PM_CMPLU_STALL_THRD,PM_CMPLU_STALL_BRU_CRU,PM_CMPLU_STALL_COQ_FULL,PM_CMPLU_STALL_BRU'
set_add_group cpi 'PM_DATA_FROM_L2,PM_CMPLU_STALL_DCACHE_MISS,PM_CMPLU_STALL_HWSYNC,PM_CMPLU_STALL_DMISS_L2L3_CONFLICT'
set_add_group cpi 'PM_DATA_FROM_L3_NO_CONFLICT,PM_CMPLU_STALL_DMISS_L21_L31,PM_CMPLU_STALL_MEM_ECC_DELAY,PM_CMPLU_STALL_DMISS_L3MISS'
set_add_group cpi 'PM_DISP_HELD,PM_CMPLU_STALL_DMISS_L2L3,PM_CMPLU_STALL_OTHER_CMPL,PM_CMPLU_STALL_DMISS_LMEM'
set_add_group cpi 'PM_FLOP,PM_CMPLU_STALL_DMISS_REMOTE,PM_DISP_WT,PM_CMPLU_STALL_ERAT_MISS'
set_add_group cpi 'PM_GCT_NOSLOT_CYC,PM_CMPLU_STALL_LSU,PM_FXU0_BUSY_FXU1_IDLE,PM_CMPLU_STALL_FXLONG'
set_add_group cpi 'PM_DATA_ALL_PUMP_CPRED,PM_CMPLU_STALL_NTCG_FLUSH,PM_L3_CO_MEPF,PM_CMPLU_STALL_LOAD_FINISH'
set_add_group cpi 'PM_IC_DEMAND_CYC,PM_CMPLU_STALL_REJECT_LHS,PM_L3_SW_PREF,PM_CMPLU_STALL_REJECT'
set_add_group cpi 'PM_L1_DCACHE_RELOADED_ALL,PM_CMPLU_STALL_SCALAR_LONG,PM_LSU_LMQ_SRQ_EMPTY_ALL_CYC,PM_CMPLU_STALL_REJ_LMQ_FULL'
set_add_group cpi 'PM_L2_TM_REQ_ABORT,PM_CMPLU_STALL_STORE,PM_MRK_STALL_CMPLU_CYC,PM_CMPLU_STALL_SCALAR'
set_add_group cpi 'PM_L3_CO_MEPF,PM_CMPLU_STALL_VECTOR,PM_MRK_ST_CMPL,PM_CMPLU_STALL_ST_FWD'
set_add_group cpi 'PM_L3_LD_PREF,PM_CMPLU_STALL_VSU,PM_ST_MISS_L1,PM_CMPLU_STALL_VECTOR_LONG'
set_add_group cpi 'PM_LSU0_REJECT,PM_GCT_NOSLOT_DISP_HELD_ISSQ,PM_IFU_L2_TOUCH,PM_GCT_NOSLOT_BR_MPRED'
set_add_group cpi 'PM_LSU_REJECT_LMQ_FULL,PM_GCT_NOSLOT_DISP_HELD_OTHER,PM_LSU_FIN,PM_GCT_NOSLOT_BR_MPRED_ICMISS'
set_add_group cpi 'PM_DATA_PUMP_CPRED,PM_GCT_NOSLOT_DISP_HELD_SRQ,PM_FLUSH_LSU,PM_GCT_NOSLOT_DISP_HELD_MAP'
set_add_group cpi 'PM_MRK_ST_CMPL,PM_GCT_NOSLOT_IC_MISS,PM_INST_CMPL,PM_GCT_NOSLOT_IC_L3MISS'
set_add_group cpi 'PM_MEM_LOC_THRESH_IFU,PM_CMPLU_STALL_NO_NTF,PM_L1_DCACHE_RELOAD_VALID,PM_DATA_FROM_OFF_CHIP_CACHE'
set_add_group cpi 'PM_CMPLU_STALL_LWSYNC,PM_MEM_PREF,PM_UP_PREF_L3,PM_UP_PREF_POINTER'

set_add_group dpf_streams 'PM_DC_PREF_STREAM_ALLOC,PM_DC_PREF_STREAM_CONF,PM_DC_PREF_STREAM_STRIDED_CONF,PM_DC_PREF_STREAM_FUZZY_CONF'

set_add_group l3_pref 'PM_LD_CMPL,PM_L3_ST_PREF,PM_L3_SW_PREF,PM_L3_PREF_ALL'

set_add_group dsource 'PM_DATA_FROM_L2,PM_DATA_FROM_L2MISS,PM_DATA_FROM_L3MISS,PM_DATA_FROM_L3'
set_add_group dsource 'PM_DATA_FROM_L2_NO_CONFLICT,PM_DATA_FROM_L2_MEPF,PM_DATA_FROM_L2_DISP_CONFLICT_LDHITST,PM_DATA_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group dsource 'PM_DATA_FROM_L3_NO_CONFLICT,PM_DATA_FROM_L3_MEPF,PM_DATA_FROM_L3_DISP_CONFLICT,PM_DATA_FROM_L3MISS_MOD'
set_add_group dsource 'PM_DATA_FROM_L31_SHR,PM_DATA_FROM_L31_MOD,PM_DATA_FROM_L31_ECO_SHR,PM_DATA_FROM_L31_ECO_MOD'
set_add_group dsource 'PM_DATA_FROM_L2MISS_MOD,PM_DATA_FROM_LMEM,PM_DATA_FROM_RMEM,PM_DATA_FROM_DMEM'
set_add_group dsource 'PM_DATA_FROM_ON_CHIP_CACHE,PM_DATA_FROM_RL2L3_MOD,PM_DATA_FROM_L21_SHR,PM_DATA_FROM_L21_MOD'
set_add_group dsource 'PM_DATA_FROM_LL4,PM_DATA_FROM_RL4,PM_DATA_FROM_DL4,PM_DATA_FROM_MEM'
set_add_group dsource 'PM_DATA_FROM_RL2L3_SHR,PM_DATA_FROM_MEMORY,PM_DATA_FROM_DL2L3_SHR,PM_DATA_FROM_DL2L3_MOD'
set_add_group dsource 'PM_DATA_ALL_FROM_L2,PM_FLOP_SUM_SCALAR,PM_FLOP_SUM_VEC,PM_DATA_ALL_FROM_L3'
set_add_group dsource 'PM_DATA_ALL_FROM_L2_NO_CONFLICT,PM_DATA_ALL_FROM_L2_MEPF,PM_DATA_ALL_FROM_L2_DISP_CONFLICT_LDHITST,PM_DATA_ALL_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group dsource 'PM_DATA_ALL_FROM_L3_NO_CONFLICT,PM_DATA_ALL_FROM_L3_MEPF,PM_DATA_ALL_FROM_L3_DISP_CONFLICT,PM_DATA_ALL_FROM_L3MISS_MOD'
set_add_group dsource 'PM_DATA_ALL_FROM_L31_SHR,PM_DATA_ALL_FROM_L31_MOD,PM_DATA_ALL_FROM_L31_ECO_SHR,PM_DATA_ALL_FROM_L31_ECO_MOD'
set_add_group dsource 'PM_DATA_ALL_FROM_L2MISS_MOD,PM_DATA_ALL_FROM_LMEM,PM_DATA_ALL_FROM_RMEM,PM_DATA_ALL_FROM_DMEM'
set_add_group dsource 'PM_DATA_ALL_FROM_ON_CHIP_CACHE,PM_DATA_ALL_FROM_RL2L3_MOD,PM_DATA_ALL_FROM_L21_SHR,PM_DATA_ALL_FROM_L21_MOD'
set_add_group dsource 'PM_DATA_ALL_FROM_LL4,PM_DATA_ALL_FROM_RL4,PM_DATA_ALL_FROM_DL4,PM_DATA_ALL_FROM_OFF_CHIP_CACHE'
set_add_group dsource 'PM_DATA_ALL_FROM_RL2L3_SHR,PM_DATA_ALL_FROM_MEMORY,PM_DATA_ALL_FROM_DL2L3_SHR,PM_DATA_ALL_FROM_DL2L3_MOD'

set_add_group isource 'PM_INST_FROM_L2,PM_INST_FROM_L2_MEPF,PM_INST_FROM_L2_DISP_CONFLICT_LDHITST,PM_INST_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group isource 'PM_INST_FROM_L2_NO_CONFLICT,PM_INST_FROM_L31_MOD,PM_INST_FROM_L21_SHR,PM_INST_FROM_L21_MOD'
set_add_group isource 'PM_INST_FROM_L3_NO_CONFLICT,PM_INST_FROM_L3_MEPF,PM_INST_FROM_L3_DISP_CONFLICT,PM_INST_FROM_L3'
set_add_group isource 'PM_INST_FROM_L2MISS,PM_INST_FROM_MEMORY,PM_INST_FROM_L3MISS,PM_INST_FROM_L3MISS_MOD'
set_add_group isource 'PM_INST_FROM_L31_SHR,PM_INST_FROM_RL2L3_MOD,PM_INST_FROM_L31_ECO_SHR,PM_INST_FROM_L31_ECO_MOD'
set_add_group isource 'PM_INST_FROM_ON_CHIP_CACHE,PM_INST_FROM_LMEM,PM_INST_FROM_RMEM,PM_INST_FROM_OFF_CHIP_CACHE'
set_add_group isource 'PM_INST_FROM_RL2L3_SHR,PM_INST_CMPL,PM_INST_FROM_DL2L3_SHR,PM_INST_FROM_DL2L3_MOD'
set_add_group isource 'PM_INST_FROM_LL4,PM_INST_FROM_RL4,PM_INST_FROM_DL4,PM_INST_FROM_DMEM'
set_add_group isource 'PM_INST_ALL_FROM_L2,PM_INST_ALL_FROM_L2_MEPF,PM_INST_ALL_FROM_L2_DISP_CONFLICT_LDHITST,PM_INST_ALL_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group isource 'PM_INST_ALL_FROM_L2_NO_CONFLICT,PM_INST_ALL_FROM_L31_MOD,PM_INST_ALL_FROM_L21_SHR,PM_INST_ALL_FROM_L21_MOD'
set_add_group isource 'PM_INST_ALL_FROM_L3_NO_CONFLICT,PM_INST_ALL_FROM_L3_MEPF,PM_INST_ALL_FROM_L3_DISP_CONFLICT,PM_INST_ALL_FROM_L3'
set_add_group isource 'PM_INST_ALL_FROM_L2MISS,PM_INST_ALL_FROM_MEMORY,PM_ISLB_MISS,PM_INST_ALL_FROM_L3MISS_MOD'
set_add_group isource 'PM_INST_ALL_FROM_L31_SHR,PM_INST_ALL_FROM_RL2L3_MOD,PM_INST_ALL_FROM_L31_ECO_SHR,PM_INST_ALL_FROM_L31_ECO_MOD'
set_add_group isource 'PM_INST_ALL_FROM_ON_CHIP_CACHE,PM_INST_ALL_FROM_LMEM,PM_INST_ALL_FROM_RMEM,PM_INST_ALL_FROM_OFF_CHIP_CACHE'
set_add_group isource 'PM_INST_ALL_FROM_RL2L3_SHR,PM_HV_CYC,PM_INST_ALL_FROM_DL2L3_SHR,PM_INST_ALL_FROM_DL2L3_MOD'
set_add_group isource 'PM_INST_ALL_FROM_LL4,PM_INST_ALL_FROM_RL4,PM_INST_ALL_FROM_DL4,PM_INST_ALL_FROM_DMEM'

set_add_group l1miss 'PM_MRK_LD_MISS_EXPOSED_CYC,PM_MRK_LD_MISS_L1,PM_INST_CMPL,PM_MRK_LD_MISS_L1_CYC'

set_add_group dsource 'PM_MRK_DATA_FROM_L2,PM_BR_UNCOND_CMPL,PM_INST_CMPL,PM_MRK_DATA_FROM_L2_CYC'
set_add_group dsource 'PM_BR_PRED_TA_CMPL,PM_MRK_DATA_FROM_L2_DISP_CONFLICT_LDHITST_CYC,PM_MRK_DATA_FROM_L2_DISP_CONFLICT_LDHITST,PM_INST_CMPL'
set_add_group dsource 'PM_INST_CMPL,PM_MRK_DATA_FROM_L2_DISP_CONFLICT_OTHER_CYC,PM_MRK_ST_CMPL_INT,PM_MRK_DATA_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group dsource 'PM_MRK_DPTEG_FROM_L2_NO_CONFLICT,PM_MRK_DATA_FROM_L2_MEPF,PM_INST_CMPL,PM_MRK_DATA_FROM_L2_MEPF_CYC'
set_add_group dsource 'PM_MRK_DATA_FROM_L2_NO_CONFLICT,PM_MRK_DATA_FROM_L21_SHR_CYC,PM_MRK_DATA_FROM_L21_SHR,PM_MRK_DATA_FROM_L2_NO_CONFLICT_CYC'
set_add_group dsource 'PM_DATA_ALL_FROM_L3_NO_CONFLICT,PM_MRK_DATA_FROM_L3_DISP_CONFLICT_CYC,PM_MRK_DATA_FROM_L3_DISP_CONFLICT,PM_INST_CMPL'
set_add_group dsource 'PM_MRK_DATA_FROM_L2MISS,PM_INST_CMPL,PM_MRK_BR_MPRED_CMPL,PM_MRK_DATA_FROM_L2MISS_CYC'
set_add_group dsource 'PM_SYNC_MRK_L2MISS,PM_MRK_DATA_FROM_L3_CYC,PM_INST_CMPL,PM_MRK_DATA_FROM_L3'
set_add_group dsource 'PM_INST_CMPL,PM_MRK_DATA_FROM_L3_MEPF,PM_ST_MISS_L1,PM_MRK_DATA_FROM_L3_MEPF_CYC'
set_add_group dsource 'PM_MRK_DATA_FROM_L3_NO_CONFLICT,PM_MRK_DATA_FROM_L31_ECO_SHR_CYC,PM_MRK_DATA_FROM_L31_ECO_SHR,PM_MRK_DATA_FROM_L3_NO_CONFLICT_CYC'
set_add_group dsource 'PM_SYNC_MRK_L3MISS,PM_MRK_DATA_FROM_L3MISS_CYC,PM_INST_CMPL,PM_MRK_DATA_FROM_L3MISS'
set_add_group dsource 'PM_MRK_DATA_FROM_ON_CHIP_CACHE,PM_BACK_BR_CMPL,PM_INST_CMPL,PM_MRK_DATA_FROM_ON_CHIP_CACHE_CYC'
set_add_group dsource 'PM_INST_CMPL,PM_MRK_DATA_FROM_L21_MOD_CYC,PM_L1_DCACHE_RELOAD_VALID,PM_MRK_DATA_FROM_L21_MOD'
set_add_group dsource 'PM_IPTEG_FROM_L2_NO_CONFLICT,PM_MRK_DATA_FROM_L31_ECO_MOD_CYC,PM_INST_CMPL,PM_MRK_DATA_FROM_L31_ECO_MOD'
set_add_group dsource 'PM_INST_ALL_PUMP_CPRED,PM_MRK_DATA_FROM_L31_MOD,PM_INST_CMPL,PM_MRK_DATA_FROM_L31_MOD_CYC'
set_add_group dsource 'PM_INST_CMPL,PM_MRK_DATA_FROM_RMEM_CYC,PM_MRK_DATA_FROM_RMEM,PM_SYS_PUMP_MPRED_RTY'
set_add_group dsource 'PM_MRK_DATA_FROM_L31_SHR,PM_DATA_ALL_FROM_L31_MOD,PM_INST_CMPL,PM_MRK_DATA_FROM_L31_SHR_CYC'
set_add_group dsource 'PM_MRK_DATA_FROM_LL4,PM_MRK_DATA_FROM_DL4_CYC,PM_MRK_DATA_FROM_DL4,PM_MRK_DATA_FROM_LL4_CYC'
set_add_group dsource 'PM_LD_L3MISS_PEND_CYC,PM_MRK_DATA_FROM_LMEM,PM_INST_CMPL,PM_MRK_DATA_FROM_LMEM_CYC'
set_add_group dsource 'PM_LD_REF_L1,PM_MRK_DATA_FROM_MEMORY,PM_INST_CMPL,PM_MRK_DATA_FROM_MEMORY_CYC'
set_add_group dsource 'PM_INST_PUMP_CPRED,PM_MRK_DATA_FROM_OFF_CHIP_CACHE_CYC,PM_INST_CMPL,PM_MRK_DATA_FROM_OFF_CHIP_CACHE'
set_add_group dsource 'PM_INST_ALL_PUMP_CPRED,PM_MRK_DATA_FROM_RL2L3_MOD,PM_INST_CMPL,PM_MRK_DATA_FROM_RL2L3_MOD_CYC'
set_add_group dsource 'PM_MRK_DATA_FROM_RL2L3_SHR,PM_MRK_DATA_FROM_DL2L3_SHR_CYC,PM_MRK_DATA_FROM_DL2L3_SHR,PM_MRK_DATA_FROM_RL2L3_SHR_CYC'
set_add_group dsource 'PM_INST_CMPL,PM_MRK_DATA_FROM_RL4,PM_ALL_SYS_PUMP_CPRED,PM_MRK_DATA_FROM_RL4_CYC'
set_add_group dsource 'PM_INST_CMPL,PM_MRK_DATA_FROM_DL2L3_MOD_CYC,PM_L2_SYS_PUMP,PM_MRK_DATA_FROM_DL2L3_MOD'
set_add_group dsource 'PM_INST_CMPL,PM_MRK_DATA_FROM_DMEM_CYC,PM_IPTEG_FROM_L2_DISP_CONFLICT_LDHITST,PM_MRK_DATA_FROM_DMEM'

set_add_group ld_lat_histogram 'PM_L1MISS_LAT_EXC_256,PM_L1MISS_LAT_EXC_32,PM_L1MISS_LAT_EXC_1024,PM_L1MISS_LAT_EXC_2048'

set_add_group store_lat 'PM_MRK_ST_L2DISP_TO_CMPL_CYC,PM_MRK_ST_NEST,PM_MRK_ST_DRAIN_TO_L2DISP_CYC,PM_INST_CMPL'

set_add_group l2_pump 'PM_L2_ST,PM_L2_CHIP_PUMP,PM_L2_SYS_PUMP,PM_INST_CMPL'
set_add_group l2_pump 'PM_L2_ST_MISS,PM_INST_CMPL,PM_L2_RTY_ST,PM_INST_CMPL'

set_add_group l2_rc_lifetime 'PM_RC_LIFETIME_EXC_256,PM_RC_LIFETIME_EXC_32,PM_RC_LIFETIME_EXC_1024,PM_RC_LIFETIME_EXC_2048'

set_add_group l2_busy 'PM_RC0_BUSY,PM_SN0_BUSY,PM_RC_USAGE,PM_SN_USAGE'
set_add_group l2_busy 'PM_CO0_BUSY,PM_L1PF_L2MEMACC,PM_CO_USAGE,PM_ISIDE_L2MEMACC'
set_add_group l2_busy 'PM_RC0_ALLOC,PM_SN0_ALLOC,PM_L3_SN0_ALLOC,PM_L3_RD0_ALLOC'
set_add_group l2_busy 'PM_CO0_ALLOC,PM_ST_CMPL,PM_L3_CO0_ALLOC,PM_L3_PF0_ALLOC'

set_add_group l3_pf_co 'PM_L3_PF_MISS_L3,PM_L3_CO_L31,PM_L3_PF_ON_CHIP_CACHE,PM_L3_PF_ON_CHIP_MEM'
set_add_group l3_pf_co 'PM_L3_LD_PREF,PM_L3_CO_MEM,PM_L3_PF_OFF_CHIP_CACHE,PM_L3_PF_OFF_CHIP_MEM'

set_add_group l3_busy 'PM_L3_SN_USAGE,PM_L3_RD_USAGE,PM_L3_SN0_BUSY,PM_L3_RD0_BUSY'
set_add_group l3_busy 'PM_L3_CI_USAGE,PM_L3_PF_USAGE,PM_L3_CO0_BUSY,PM_L3_PF0_BUSY'

set_add_group vsu 'PM_VSU0_1FLOP,PM_VSU1_1FLOP,PM_VSU0_2FLOP,PM_VSU1_2FLOP'
set_add_group vsu 'PM_VSU0_4FLOP,PM_VSU1_4FLOP,PM_VSU0_8FLOP,PM_VSU1_8FLOP'
set_add_group vsu 'PM_VSU0_COMPLEX_ISSUED,PM_VSU1_COMPLEX_ISSUED,PM_VSU0_SIMPLE_ISSUED,PM_VSU1_SIMPLE_ISSUED'
set_add_group vsu 'PM_VSU0_DP_FMA,PM_VSU1_DP_FMA,PM_VSU0_FMA,PM_VSU1_FMA'
set_add_group vsu 'PM_VSU1_DD_ISSUED,PM_VSU0_DD_ISSUED,PM_VSU0_CY_ISSUED,PM_VSU1_CY_ISSUED'
set_add_group vsu 'PM_VSU1_FSQRT_FDIV,PM_VSU0_SQ,PM_VSU1_SQ,PM_VSU0_16FLOP'
set_add_group vsu 'PM_VSU0_SINGLE,PM_VSU1_SINGLE,PM_VSU0_FIN,PM_VSU1_FIN'
set_add_group vsu 'PM_VSU0_EX_ISSUED,PM_VSU1_EX_ISSUED,PM_VSU0_DQ_ISSUED,PM_VSU1_DQ_ISSUED'
set_add_group vsu 'PM_VSU0_VECTOR_DP_ISSUED,PM_VSU1_VECTOR_DP_ISSUED,PM_VSU0_VECTOR_SP_ISSUED,PM_VSU1_VECTOR_SP_ISSUED'
set_add_group vsu 'PM_VSU0_SCALAR_DP_ISSUED,PM_VSU1_SCALAR_DP_ISSUED,PM_VSU0_DP_FSQRT_FDIV,PM_VSU1_DP_FSQRT_FDIV'
set_add_group vsu 'PM_VSU0_FPSCR,PM_VSU1_FPSCR,PM_VSU0_DP_2FLOP,PM_VSU1_DP_2FLOP'
set_add_group vsu 'PM_VSU0_STF,PM_VSU1_STF,PM_VSU0_PERMUTE_ISSUED,PM_VSU1_PERMUTE_ISSUED'
set_add_group vsu 'PM_VSU0_FSQRT_FDIV,PM_VSU1_FSQRT_FDIV,PM_VSU1_16FLOP,PM_IPTEG_FROM_L3'

set_add_group dfu 'PM_DFU,PM_DFU_DCFFIX,PM_DFU_DENBCD,PM_DFU_MC'

set_add_group dpteg 'PM_DPTEG_FROM_L2_NO_CONFLICT,PM_DPTEG_FROM_L2_MEPF,PM_DPTEG_FROM_L2_DISP_CONFLICT_LDHITST,PM_DPTEG_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group dpteg 'PM_DPTEG_FROM_L3_NO_CONFLICT,PM_DPTEG_FROM_L3_MEPF,PM_DPTEG_FROM_L3_DISP_CONFLICT,PM_DPTEG_FROM_L3'
set_add_group dpteg 'PM_DPTEG_FROM_L31_SHR,PM_DPTEG_FROM_L31_MOD,PM_DPTEG_FROM_L31_ECO_SHR,PM_DPTEG_FROM_L31_ECO_MOD'
set_add_group dpteg 'PM_DPTEG_FROM_RL2L3_SHR,PM_DPTEG_FROM_RL2L3_MOD,PM_DPTEG_FROM_DL2L3_SHR,PM_DPTEG_FROM_DL2L3_MOD'
set_add_group dpteg 'PM_DPTEG_FROM_ON_CHIP_CACHE,PM_DPTEG_FROM_MEMORY,PM_DPTEG_FROM_RMEM,PM_DPTEG_FROM_OFF_CHIP_CACHE'
set_add_group dpteg 'PM_DPTEG_FROM_LL4,PM_DPTEG_FROM_RL4,PM_DPTEG_FROM_DL4,PM_DPTEG_FROM_DMEM'
set_add_group dpteg 'PM_DPTEG_FROM_L2MISS,PM_DPTEG_FROM_LMEM,PM_DPTEG_FROM_RMEM,PM_DPTEG_FROM_L3MISS'
set_add_group dpteg 'PM_DPTEG_FROM_L2,PM_INST_CMPL,PM_DPTEG_FROM_L21_SHR,PM_DPTEG_FROM_L21_MOD'

set_add_group ipteg 'PM_IPTEG_FROM_L3_NO_CONFLICT,PM_IPTEG_FROM_L3_MEPF,PM_IPTEG_FROM_L3_DISP_CONFLICT,PM_IPTEG_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group ipteg 'PM_IPTEG_FROM_L31_SHR,PM_IPTEG_FROM_L31_MOD,PM_IPTEG_FROM_L31_ECO_SHR,PM_IPTEG_FROM_L31_ECO_MOD'
set_add_group ipteg 'PM_IPTEG_FROM_RL2L3_SHR,PM_IPTEG_FROM_RL2L3_MOD,PM_IPTEG_FROM_DL2L3_SHR,PM_IPTEG_FROM_DL2L3_MOD'
set_add_group ipteg 'PM_IPTEG_FROM_ON_CHIP_CACHE,PM_IPTEG_FROM_MEMORY,PM_IPTEG_FROM_RMEM,PM_IPTEG_FROM_OFF_CHIP_CACHE'
set_add_group ipteg 'PM_IPTEG_FROM_LL4,PM_IPTEG_FROM_RL4,PM_IPTEG_FROM_DL4,PM_IPTEG_FROM_L3MISS'
set_add_group ipteg 'PM_IPTEG_FROM_L2MISS,PM_IPTEG_FROM_LMEM,PM_IPTEG_FROM_RMEM,PM_IPTEG_FROM_DMEM'
set_add_group ipteg 'PM_IPTEG_FROM_L2,PM_IPTEG_FROM_L2_MEPF,PM_IPTEG_FROM_L21_SHR,PM_IPTEG_FROM_L21_MOD'

set_add_group mrk_dpteg 'PM_INST_CMPL,PM_MRK_DPTEG_FROM_L2_MEPF,PM_MRK_DPTEG_FROM_L2_DISP_CONFLICT_LDHITST,PM_MRK_DPTEG_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_L3_NO_CONFLICT,PM_MRK_DPTEG_FROM_L3_MEPF,PM_INST_CMPL,PM_MRK_DPTEG_FROM_L3'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_L31_SHR,PM_MRK_DPTEG_FROM_L31_MOD,PM_INST_CMPL,PM_MRK_DPTEG_FROM_L31_ECO_MOD'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_L2,PM_INST_CMPL,PM_MRK_DPTEG_FROM_L21_SHR,PM_MRK_DPTEG_FROM_L21_MOD'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_RL2L3_SHR,PM_INST_CMPL,PM_MRK_DPTEG_FROM_DL2L3_SHR,PM_MRK_DPTEG_FROM_DL2L3_MOD'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_ON_CHIP_CACHE,PM_MRK_DPTEG_FROM_LMEM,PM_INST_CMPL,PM_MRK_DPTEG_FROM_OFF_CHIP_CACHE'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_LL4,PM_MRK_DPTEG_FROM_RL4,PM_MRK_DPTEG_FROM_DL4,PM_INST_CMPL'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_L2MISS,PM_MRK_DATA_FROM_MEM,PM_INST_CMPL,PM_MRK_DPTEG_FROM_L3MISS'
set_add_group mrk_dpteg 'PM_INST_CMPL,PM_MRK_DPTEG_FROM_MEMORY,PM_MRK_DPTEG_FROM_RMEM,PM_MRK_DPTEG_FROM_DMEM'
set_add_group mrk_dpteg 'PM_INST_CMPL,PM_MRK_DPTEG_FROM_RL2L3_MOD,PM_MRK_DPTEG_FROM_L3_DISP_CONFLICT,PM_MRK_DPTEG_FROM_L2_DISP_CONFLICT_OTHER'
set_add_group mrk_dpteg 'PM_MRK_DPTEG_FROM_L31_SHR,PM_INST_CMPL,PM_MRK_DPTEG_FROM_L31_ECO_SHR,PM_MRK_DPTEG_FROM_L31_ECO_MOD'

set_add_group lsu_fin 'PM_LSU_FX_FIN,PM_ST_FIN,PM_LSU_FIN,PM_LD_MISS_L1'

set_add_group lrq_lifetime 'PM_LSU_LRQ_S0_ALLOC,PM_LSU_LRQ_S43_VALID,PM_LSU_LRQ_S43_ALLOC,PM_LSU_LRQ_S0_VALID'

set_add_group lmq_lifetime 'PM_LSU_LMQ_FULL_CYC,PM_LSU_LMQ_SRQ_EMPTY_CYC,PM_LSU_LMQ_S0_ALLOC,PM_LSU_LMQ_S0_VALID'

set_add_group srq_lifetime 'PM_LSU_SRQ_S39_ALLOC,PM_LSU_SRQ_S0_VALID,PM_LSU_SRQ_S0_ALLOC,PM_LSU_SRQ_S39_VALID'

set_add_group srq_full 'PM_LSU_SRQ_FULL_CYC,PM_REAL_SRQ_FULL,PM_DISP_HELD_SRQ_FULL,PM_LSU_STORE_REJECT'

set_add_group lsu_lmq_merge 'PM_LSU0_LMQ_LHR_MERGE,PM_LSU1_LMQ_LHR_MERGE,PM_LSU2_LMQ_LHR_MERGE,PM_LSU3_LMQ_LHR_MERGE'

set_add_group ld_ref_l1 'PM_LD_REF_L1_LSU0,PM_LD_REF_L1_LSU1,PM_LD_REF_L1_LSU2,PM_LD_REF_L1_LSU3'

set_add_group l1_pref 'PM_LS0_L1_PREF,PM_LS1_L1_PREF,PM_LS0_L1_SW_PREF,PM_LS1_L1_SW_PREF'

set_add_group st_fw 'PM_LSU0_SRQ_STFWD,PM_LSU1_SRQ_STFWD,PM_LSU2_SRQ_STFWD,PM_LSU3_SRQ_STFWD'

set_add_group lsu_flush 'PM_LSU0_FLUSH_UST,PM_LSU1_FLUSH_UST,PM_FREQ_DOWN,PM_FREQ_UP'
set_add_group lsu_flush 'PM_LSU0_FLUSH_LRQ,PM_LSU1_FLUSH_LRQ,PM_LSU2_FLUSH_LRQ,PM_LSU3_FLUSH_LRQ'
set_add_group lsu_flush 'PM_LSU0_FLUSH_ULD,PM_LSU1_FLUSH_ULD,PM_LSU2_FLUSH_ULD,PM_LSU3_FLUSH_ULD'
set_add_group lsu_flush 'PM_LSU0_FLUSH_SRQ,PM_LSU1_FLUSH_SRQ,PM_LSU2_FLUSH_SRQ,PM_LSU3_FLUSH_SRQ'

set_add_group lsu_misc 'PM_PTE_PREFETCH,PM_TABLEWALK_CYC_PREF,PM_LSU_FOUR_TABLEWALK_CYC,PM_LSU_TWO_TABLEWALK_CYC'
set_add_group lsu_misc 'PM_LSU0_PRIMARY_ERAT_HIT,PM_LSU1_PRIMARY_ERAT_HIT,PM_LSU2_PRIMARY_ERAT_HIT,PM_LSU3_PRIMARY_ERAT_HIT'
set_add_group lsu_misc 'PM_LSU2_LDF,PM_LSU3_LDF,PM_LSU2_LDX,PM_LSU3_LDX'
set_add_group lsu_misc 'PM_LSU0_NCLD,PM_LSU1_NCLD,PM_LSU_NCST,PM_SNOOP_TLBIE'
set_add_group lsu_misc 'PM_DSLB_MISS,PM_ISLB_MISS,PM_LS0_ERAT_MISS_PREF,PM_LS1_ERAT_MISS_PREF'
set_add_group lsu_misc 'PM_LSU_SRQ_SYNC,PM_LSU_SET_MPRED,PM_LSU_SRQ_SYNC_CYC,PM_SEC_ERAT_HIT'

set_add_group lsu_tm 'PM_UP_PREF_L3,PM_UP_PREF_POINTER,PM_DC_COLLISIONS,PM_TEND_PEND_CYC'
set_add_group lsu_tm 'PM_TM_FAIL_DISALLOW,PM_TM_FAIL_TLBIE,PM_TM_FAIL_TX_CONFLICT,PM_TM_FAIL_NON_TX_CONFLICT'
set_add_group lsu_tm 'PM_LSU0_TM_L1_HIT,PM_LSU1_TM_L1_HIT,PM_LSU2_TM_L1_HIT,PM_LSU3_TM_L1_HIT'
set_add_group lsu_tm 'PM_LSU0_TM_L1_MISS,PM_LSU1_TM_L1_MISS,PM_LSU2_TM_L1_MISS,PM_LSU3_TM_L1_MISS'
set_add_group lsu_tm 'PM_LSU0_TMA_REQ_L2,PM_LSU1_TMA_REQ_L2,PM_LSU2_TMA_REQ_L2,PM_LSU3_TMA_REQ_L2'
set_add_group lsu_tm 'PM_LSU0_L1_CAM_CANCEL,PM_LSU1_L1_CAM_CANCEL,PM_LSU2_L1_CAM_CANCEL,PM_LSU3_L1_CAM_CANCEL'

set_add_group tm_events 'PM_TM_FAIL_CON_TM,PM_FAV_TBEGIN,PM_TM_FAIL_FOOTPRINT_OVERFLOW,PM_TM_FAIL_SELF'
set_add_group tm_events 'PM_TM_TRANS_RUN_CYC,PM_TM_TRESUME,PM_TM_TRANS_RUN_INST,PM_TM_TSUSPEND'
set_add_group tm_events 'PM_TM_TBEGIN,PM_TM_TX_PASS_RUN_CYC,PM_TM_TRANS_RUN_INST,PM_TM_TX_PASS_RUN_INST'
set_add_group tm_events 'PM_TM_FAIL_CONF_NON_TM,PM_TM_BEGIN_ALL,PM_L2_TM_ST_ABORT_SISTER,PM_TM_END_ALL'
set_add_group tm_events 'PM_NESTED_TEND,PM_NON_FAV_TBEGIN,PM_OUTER_TBEGIN,PM_OUTER_TEND'

set_add_group bandwidth 'PM_MEM_READ,PM_MEM_PREF,PM_MEM_RWITM,PM_MEM_CO'

set_add_group pump_pred 'PM_CHIP_PUMP_CPRED,PM_GRP_PUMP_CPRED,PM_SYS_PUMP_CPRED,PM_PUMP_MPRED'
set_add_group pump_pred 'PM_PUMP_CPRED,PM_GRP_PUMP_MPRED,PM_SYS_PUMP_MPRED,PM_SYS_PUMP_MPRED_RTY'
set_add_group pump_pred 'PM_DATA_CHIP_PUMP_CPRED,PM_DATA_GRP_PUMP_CPRED,PM_DATA_SYS_PUMP_CPRED,PM_DATA_SYS_PUMP_MPRED_RTY'
set_add_group pump_pred 'PM_GRP_PUMP_MPRED_RTY,PM_DATA_GRP_PUMP_MPRED,PM_DATA_SYS_PUMP_MPRED,PM_DATA_PUMP_MPRED'
set_add_group pump_pred 'PM_INST_CHIP_PUMP_CPRED,PM_INST_GRP_PUMP_CPRED,PM_INST_SYS_PUMP_CPRED,PM_INST_SYS_PUMP_MPRED_RTY'
set_add_group pump_pred 'PM_INST_GRP_PUMP_MPRED_RTY,PM_INST_GRP_PUMP_MPRED,PM_INST_SYS_PUMP_MPRED,PM_INST_PUMP_MPRED'
set_add_group pump_pred 'PM_ALL_CHIP_PUMP_CPRED,PM_ALL_GRP_PUMP_CPRED,PM_ALL_SYS_PUMP_CPRED,PM_ALL_PUMP_MPRED'
set_add_group pump_pred 'PM_ALL_PUMP_CPRED,PM_ALL_GRP_PUMP_MPRED,PM_ALL_SYS_PUMP_MPRED,PM_ALL_SYS_PUMP_MPRED_RTY'
set_add_group pump_pred 'PM_DATA_ALL_CHIP_PUMP_CPRED,PM_DATA_ALL_GRP_PUMP_CPRED,PM_DATA_ALL_SYS_PUMP_CPRED,PM_DATA_ALL_SYS_PUMP_MPRED_RTY'
set_add_group pump_pred 'PM_ALL_GRP_PUMP_MPRED_RTY,PM_DATA_ALL_GRP_PUMP_MPRED,PM_DATA_ALL_SYS_PUMP_MPRED,PM_DATA_ALL_PUMP_MPRED'
set_add_group pump_pred 'PM_INST_ALL_CHIP_PUMP_CPRED,PM_INST_ALL_GRP_PUMP_CPRED,PM_INST_ALL_SYS_PUMP_CPRED,PM_INST_ALL_SYS_PUMP_MPRED_RTY'
set_add_group pump_pred 'PM_INST_ALL_GRP_PUMP_MPRED_RTY,PM_INST_ALL_GRP_PUMP_MPRED,PM_INST_ALL_SYS_PUMP_MPRED,PM_INST_ALL_PUMP_MPRED'

set_add_group mrk_fab_rsp 'PM_INST_CMPL,PM_MRK_FAB_RSP_BKILL_CYC,PM_MRK_FAB_RSP_CLAIM_RTY,PM_MRK_FAB_RSP_BKILL'
set_add_group mrk_fab_rsp 'PM_INST_CMPL,PM_MRK_FAB_RSP_DCLAIM_CYC,PM_MRK_FAB_RSP_DCLAIM,PM_MRK_FAB_RSP_RD_RTY'
set_add_group mrk_fab_rsp 'PM_MRK_FAB_RSP_RD_T_INTV,PM_MRK_FAB_RSP_RWITM_RTY,PM_INST_CMPL,PM_MRK_FAB_RSP_RWITM_CYC'

set_add_group larx 'PM_LSU0_LARX_FIN,PM_LSU1_LARX_FIN,PM_LSU2_LARX_FIN,PM_LSU3_LARX_FIN'

set_add_group stcx 'PM_STCX_FAIL,PM_STCX_LSU,PM_LARX_FIN,PM_LSU_SRQ_EMPTY_CYC'

set_add_group erat_events 'PM_IERAT_RELOAD,PM_IERAT_RELOAD_4K,PM_IERAT_RELOAD_64K,PM_IERAT_RELOAD_16M'

set_add_group tlb 'PM_CYC,PM_LSU_DERAT_MISS,PM_DTLB_MISS,PM_ITLB_MISS'

set_add_group misc81 'PM_DATA_PUMP_CPRED,PM_TLB_MISS,PM_TLBIE_FIN,PM_LSU_ERAT_MISS_PREF'

set_add_group tablewalk_cyc 'PM_TABLEWALK_CYC,PM_TABLEWALK_CYC_PREF,PM_DATA_TABLEWALK_CYC,PM_LD_MISS_L1'

set_add_group imc_match 'PM_INST_IMC_MATCH_CMPL,PM_INST_FROM_L1,PM_INST_IMC_MATCH_DISP,PM_INST_CMPL'

set_add_group ext_int 'PM_EE_OFF_EXT_INT,PM_EXT_INT,PM_TB_BIT_TRANS,PM_CYC'

set_add_group icache 'PM_L1_DEMAND_WRITE,PM_IC_PREF_WRITE,PM_IBUF_FULL_CYC,PM_BANK_CONFLICT'
set_add_group icache 'PM_IC_DEMAND_L2_BHT_REDIRECT,PM_IC_DEMAND_L2_BR_REDIRECT,PM_IC_DEMAND_REQ,PM_IC_INVALIDATE'
set_add_group icache 'PM_GRP_IC_MISS_NONSPEC,PM_L1_ICACHE_MISS,PM_IC_RELOAD_PRIVATE,PM_LSU_L1_SW_PREF'
set_add_group icache 'PM_IC_PREF_CANCEL_HIT,PM_IC_PREF_CANCEL_L2,PM_IC_PREF_CANCEL_PAGE,PM_IC_PREF_REQ'
set_add_group icache 'PM_DATA_ALL_GRP_PUMP_MPRED_RTY,PM_ST_FWD,PM_L1_ICACHE_RELOADED_PREF,PM_L1_ICACHE_RELOADED_ALL'

set_add_group multi_lpar_cyc 'PM_1LPAR_CYC,PM_2LPAR_CYC,PM_INST_CMPL,PM_4LPAR_CYC'

set_add_group fusion_toc 'PM_FUSION_TOC_GRP0_1,PM_FUSION_TOC_GRP0_2,PM_FUSION_TOC_GRP0_3,PM_FUSION_TOC_GRP1_1'

set_add_group fusion_vsx 'PM_FUSION_VSX_GRP0_1,PM_FUSION_VSX_GRP0_2,PM_FUSION_VSX_GRP0_3,PM_FUSION_VSX_GRP1_1'

set_add_group gct_util 'PM_GCT_UTIL_1_2_ENTRIES,PM_GCT_UTIL_3_6_ENTRIES,PM_GCT_UTIL_7_10_ENTRIES,PM_GCT_UTIL_11_14_ENTRIES'
set_add_group gct_util 'PM_GCT_UTIL_15_17_ENTRIES,PM_GCT_UTIL_18_ENTRIES,PM_DISP_HOLD_GCT_FULL,PM_GCT_MERGE'
set_add_group gct_util 'PM_STALL_END_GCT_EMPTY,PM_GCT_EMPTY_CYC,PM_CYC,PM_FLUSH_DISP'

set_add_group fpu 'PM_FPU0_FCONV,PM_FPU0_FEST,PM_FPU0_FRSP,PM_LSU_LDF'
set_add_group fpu 'PM_FPU1_FCONV,PM_FPU1_FEST,PM_FPU1_FRSP,PM_LSU_LDX'

set_add_group grp_term1 'PM_GRP_NON_FULL_GROUP,PM_GRP_TERM_2ND_BRANCH,PM_GRP_TERM_FPU_AFTER_BR,PM_GRP_TERM_NOINST'

set_add_group shl 'PM_SHL_CREATED,PM_SHL_ST_CONVERT,PM_SHL_ST_DISABLE,PM_EAT_FULL_CYC'

set_add_group grp_term2 'PM_GRP_BR_MPRED_NONSPEC,PM_GRP_TERM_OTHER,PM_GRP_TERM_SLOT_LIMIT,PM_EAT_FORCE_MISPRED'

set_add_group link_stack 'PM_CLB_HELD,PM_LINK_STACK_INVALID_PTR,PM_LINK_STACK_WRONG_ADD_PRED,PM_ISU_REF_FXU'

set_add_group uthrottle 'PM_DATA_GRP_PUMP_MPRED_RTY,PM_INST_CMPL,PM_IFETCH_THROTTLE,PM_IFU_L2_TOUCH'

set_add_group rejects 'PM_ISU_REJECTS_ALL,PM_ISU_REJECT_SAR_BYPASS,PM_ISU_REJECT_SRC_NA,PM_ISU_REJECT_RES_NA'
set_add_group rejects 'PM_LSU0_STORE_REJECT,PM_LSU1_STORE_REJECT,PM_LSU2_REJECT,PM_LSU_REJECT_LHS'
set_add_group rejects 'PM_LSU_REJECT_LMQ_FULL,PM_LSU_REJECT_ERAT_MISS,PM_LSU2_REJECT,PM_LSU3_REJECT'
set_add_group rejects 'PM_LSU_REJECT,PM_LSU1_REJECT,PM_MRK_LSU_REJECT_ERAT_MISS,PM_MRK_LSU_REJECT'
set_add_group rejects 'PM_ISU_REF_FX0,PM_ISU_REF_LS0,PM_ISU_REF_LS1,PM_ISU_REF_LS2'
set_add_group rejects 'PM_ISU_REF_LS3,PM_ISU_REJ_VS0,PM_ISU_REJ_VS1,PM_ISU_REF_FX1'

set_add_group sar 'PM_SWAP_CANCEL,PM_SWAP_CANCEL_GPR,PM_SWAP_COMPLETE,PM_SWAP_COMPLETE_GPR'
set_add_group sar 'PM_MEM_LOC_THRESH_LSU_MED,PM_CASTOUT_ISSUED,PM_CASTOUT_ISSUED_GPR,PM_MEM_LOC_THRESH_LSU_HIGH'

set_add_group tm 'PM_TEND_PEND_CYC,PM_TABORT_TRECLAIM,PM_LSU_NCLD,PM_CYC'

set_add_group sync 'PM_ISYNC,PM_LWSYNC,PM_LWSYNC_HELD,PM_FLUSH_DISP_SYNC'

set_add_group mrk_inst 'PM_MRK_INST_ISSUED,PM_MRK_INST_DECODED,PM_INST_CMPL,PM_MRK_INST_FROM_L3MISS'
set_add_group mrk_inst 'PM_MRK_INST_DISP,PM_INST_CMPL,PM_MRK_INST_FIN,PM_MRK_INST_TIMEO'
set_add_group mrk_inst 'PM_GRP_MRK,PM_INST_CMPL,PM_LSU_MRK_DERAT_MISS,PM_MRK_GRP_CMPL'
set_add_group mrk_inst 'PM_GRP_MRK,PM_INST_CMPL,PM_MRK_GRP_NTC,PM_MRK_GRP_IC_MISS'
set_add_group mrk_inst 'PM_MRK_L1_ICACHE_MISS,PM_INST_CMPL,PM_MULT_MRK,PM_MRK_INST_TIMEO'

set_add_group mrk_br 'PM_MRK_BR_CMPL,PM_MRK_BRU_FIN,PM_MRK_BACK_BR_CMPL,PM_INST_CMPL'
set_add_group mrk_br 'PM_MRK_BR_TAKEN_CMPL,PM_INST_CMPL,PM_MRK_BR_MPRED_CMPL,PM_BR_MRK_2PATH'
set_add_group mrk_br 'PM_SYNC_MRK_BR_LINK,PM_BR_PRED_LSTACK_CMPL,PM_INST_CMPL,PM_MRK_INST_CMPL'
set_add_group mrk_br 'PM_SYNC_MRK_BR_MPRED,PM_INST_CMPL,PM_BR_PRED_CR_CMPL,PM_BR_PRED_CCACHE_CMPL'

set_add_group mrk_st 'PM_MRK_ST_CMPL,PM_MRK_L2_RC_DISP,PM_MRK_ST_FWD,PM_INST_CMPL'

set_add_group mrk_lsu_flush 'PM_MRK_LSU_FLUSH_LRQ,PM_MRK_LSU_FLUSH_SRQ,PM_INST_CMPL,PM_LSU_FLUSH_UST'
set_add_group mrk_lsu_flush 'PM_INST_CMPL,PM_MRK_LSU_FLUSH,PM_MRK_LSU_FLUSH_ULD,PM_MRK_LSU_FLUSH_UST'

set_add_group mrk_larx_stcx 'PM_MRK_FIN_STALL_CYC,PM_INST_CMPL,PM_MRK_STCX_FAIL,PM_MRK_LARX_FIN'

set_add_group mrk_fin 'PM_MRK_RUN_CYC,PM_MRK_DFU_FIN,PM_INST_CMPL,PM_MRK_LSU_FIN'
set_add_group mrk_fin 'PM_INST_CMPL,PM_MRK_FXU_FIN,PM_MRK_CRU_FIN,PM_CRU_FIN'
set_add_group mrk_fin 'PM_INST_CMPL,PM_MRK_NTF_FIN,PM_MRK_VSU_FIN,PM_ISU_REJ_VSU'

set_add_group mrk_reload 'PM_MRK_L1_RELOAD_VALID,PM_LSU_L1_PREF,PM_INST_CMPL,PM_MRK_DCACHE_RELOAD_INTV'

set_add_group mrk_l2 'PM_SYNC_MRK_L2HIT,PM_MRK_L2_RC_DISP,PM_MRK_L2_RC_DONE,PM_INST_CMPL'

set_add_group mrk_misc31 'PM_SYNC_MRK_PROBE_NOP,PM_INST_CMPL,PM_MRK_BACK_BR_CMPL,PM_PROBE_NOP_DISP'

set_add_group mrk_fxu 'PM_SYNC_MRK_FX_DIVIDE,PM_MRK_FXU_FIN,PM_ISU_REF_FX0,PM_INST_CMPL'

set_add_group mrk_derat_miss 'PM_INST_CMPL,PM_MRK_DERAT_MISS_64K,PM_MRK_DERAT_MISS_16M,PM_MRK_DERAT_MISS_16G'
set_add_group mrk_derat_miss 'PM_MRK_DERAT_MISS_4K,PM_INST_CMPL,PM_MRK_DERAT_MISS,PM_MRK_DTLB_MISS_16M'

set_add_group mrk_dtlb_miss 'PM_INST_CMPL,PM_MRK_DTLB_MISS_4K,PM_MRK_DTLB_MISS_64K,PM_MRK_DTLB_MISS'
set_add_group mrk_dtlb_miss 'PM_MRK_DTLB_MISS_16G,PM_MRK_DTLB_MISS_4K,PM_DTLB_MISS,PM_INST_CMPL'

duration=$1
shift

SETS=$*
if [ -z "$SETS" ]; then
	SETS="${setname[*]}"
	groups=${#group[*]}
else
	groups=0
	for set in $SETS; do
		groups=$((groups+${setsize[$set]}))
	done
fi

group_duration=$(echo "scale=3; $duration / $groups" | bc)

count=1
for set in $SETS; do
	for i in $(seq 0 $((${setsize[$set]} - 1))); do
		echo "[$count/$groups] $set $i: ${group["$set$i"]}"
		ocount --system-wide -e ${group["$set$i"]},PM_RUN_INST_CMPL,PM_RUN_CYC &
		sleep $group_duration
		kill -SIGINT %%
		wait
		count=$((count+1))
	done
done
exit 0
